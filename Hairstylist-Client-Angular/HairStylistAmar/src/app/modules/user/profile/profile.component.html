<div class="profile-page">
  <h2 class="page-title">My Profile</h2>

  <p *ngIf="loading" class="text-muted">Loading profile...</p>

  <div *ngIf="!loading && profile" class="profile-card">

    <!-- HEADER -->
    <div class="profile-header">
      <div class="photo-box">
        <img
          class="profile-avatar"
          [src]="
            profile?.photoUrl
              ? API_BASE + profile.photoUrl
              : 'assets/Images/default-avatar.png'
          "
          alt="User Photo"
        />

        <label class="upload-btn">
          ðŸ“· Change Photo
          <input
            type="file"
            accept="image/png,image/jpeg,image/jpg,image/webp"
            (change)="onPhotoSelected($event)"
            hidden
          />
        </label>
      </div>

      <div class="profile-basic">
        <h3>{{ profile.fullName }}</h3>
        <p class="email">{{ profile.email }}</p>
      </div>

      <button class="edit-btn" (click)="editMode = !editMode">
        {{ editMode ? "Cancel" : "Edit Profile" }}
      </button>
    </div>

    <!-- VIEW MODE -->
    <div class="profile-body" *ngIf="!editMode">
      <div class="info-row">
        <label>Full Name</label>
        <span>{{ profile.fullName }}</span>
      </div>

      <div class="info-row">
        <label>Email</label>
        <span>{{ profile.email }}</span>
      </div>

      <div class="info-row">
        <label>Mobile</label>
        <span>{{ profile.mobile || "Not added" }}</span>
      </div>
    </div>

    <!-- EDIT MODE -->
    <form *ngIf="editMode" class="profile-body" (ngSubmit)="saveProfile()">
      <div class="info-row">
        <label>Full Name</label>
        <input
          type="text"
          [(ngModel)]="profile.fullName"
          name="fullName"
          required
        />
      </div>

      <div class="info-row">
        <label>Mobile</label>
        <input
          type="tel"
          [(ngModel)]="profile.mobile"
          name="mobile"
          placeholder="Enter 10-digit mobile number"
          maxlength="10"
          pattern="[0-9]{10}"
          inputmode="numeric"
          (keypress)="allowOnlyDigits($event)"
        />
      </div>

      <div class="actions">
        <button type="submit" class="save-btn">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- ðŸ”” Profile Popup -->
<div class="popup-overlay" *ngIf="showPopup">
  <div class="popup-modal">
    <h3 [ngClass]="popupType">
      {{ popupType === 'success' ? 'Success' : 'Error' }}
    </h3>
    <p>{{ popupMessage }}</p>
    <button class="popup-btn" (click)="closePopup()">OK</button>
  </div>
</div>
